<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temario Dinámico - EsMuRPG</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        base: '#0d1117',
                        card: '#161b22',
                        border: '#30363d',
                        amber: '#fbbf24',
                        terracotta: '#ea580c'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            background-color: #0d1117;
            /* Azul noche / Space negro */
            color: #e5e7eb;
            font-family: 'Inter', sans-serif;
        }

        /* Ocultar la flecha por defecto del details en la mayoría de los navegadores */
        details>summary {
            list-style: none;
        }

        details>summary::-webkit-details-marker {
            display: none;
        }

        /* Rotar el icono de flecha personalizado cuando el acordeón está abierto */
        details[open] summary .caret-icon {
            transform: rotate(180deg);
        }
    </style>
</head>

<body class="min-h-screen p-4 md:p-8 bg-base antialiased selection:bg-amber selection:text-base">

    <main class="max-w-4xl mx-auto mt-8">
        <!-- CABECERA DEL CURSO -->
        <header
            class="mb-10 bg-card border border-border rounded-2xl p-6 md:p-8 flex flex-col md:flex-row shadow-2xl relative overflow-hidden items-center md:items-start justify-between">
            <!-- Barra de acento lateral (Cyber-Folklore) -->
            <div class="absolute top-0 left-0 w-2 h-full bg-gradient-to-b from-amber to-terracotta"></div>

            <div class="flex-1 pr-4 z-10 text-center md:text-left">
                <p
                    class="text-terracotta font-semibold tracking-wider text-sm uppercase mb-2 flex items-center justify-center md:justify-start gap-2">
                    <i class="ph ph-planet text-xl"></i> Ruta de Aprendizaje
                </p>
                <h1 id="curso-titulo" class="text-3xl md:text-4xl font-bold text-white mb-2 tracking-tight">Cargando...
                </h1>
                <p class="text-gray-400 text-sm">Explora tu camino en el mundo del Cyber-Folklore musical.</p>
            </div>

            <div class="mt-6 md:mt-0 flex items-center justify-center flex-col z-10 shrink-0">
                <div class="relative w-28 h-28 flex items-center justify-center">
                    <!-- Fondo del círculo de progreso -->
                    <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                        <path class="text-border" stroke-width="3" stroke="currentColor" fill="none"
                            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <!-- Anillo de progreso animado -->
                        <path id="curso-avance-circulo" class="text-amber transition-all duration-1000 ease-out"
                            stroke-dasharray="0, 100" stroke-width="3" stroke-linecap="round" stroke="currentColor"
                            fill="none"
                            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                    </svg>
                    <!-- Texto central del porcentaje -->
                    <div
                        class="absolute inset-0 flex items-center justify-center flex-col shadow-[0_0_20px_rgba(251,191,36,0.1)] rounded-full bg-base/50 backdrop-blur-sm m-3 border border-border/50">
                        <span id="curso-avance-texto"
                            class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-br from-amber to-yellow-200">0%</span>
                    </div>
                </div>
                <p
                    class="text-gray-400 text-xs mt-3 uppercase tracking-widest font-semibold flex flex-col items-center">
                    COMPLETADO
                </p>
            </div>
        </header>

        <!-- CONTENEDOR DE MÓDULOS -->
        <div id="contenedor-modulos" class="space-y-4 relative">
            <!-- Decoración de línea conectora de cyber-folklore de fondo -->
            <div class="absolute left-[39px] top-4 bottom-4 w-px bg-border -z-10 hidden md:block"></div>
            <!-- Los módulos se inyectarán aquí -->
        </div>
    </main>

    <!-- SCRIPT DE RENDERIZADO -->
    <script src="datos/curso_lectura.js"></script>
    <script>

        // 3. REQUISITOS DE LÓGICA E INTERFAZ
        function renderizarCurso() {
            // -- Cabecera --
            document.getElementById('curso-titulo').textContent = datosCurso.titulo;
            document.getElementById('curso-avance-texto').textContent = `${datosCurso.avance_total}%`;

            // Animar el círculo SVG (100 ms de delay para ver el efecto al cargar)
            setTimeout(() => {
                document.getElementById('curso-avance-circulo').setAttribute('stroke-dasharray', `${datosCurso.avance_total}, 100`);
            }, 100);

            // -- Contenedor de Módulos --
            const contenedor = document.getElementById('contenedor-modulos');
            let htmlModulos = '';

            // Iterar Módulos
            datosCurso.modulos.forEach(modulo => {
                if (modulo.estado === "abierto") {
                    // MÓDULO ABIERTO: `<details open>`
                    htmlModulos += `
                        <details open class="group bg-card border border-border rounded-xl mb-6 overflow-hidden shadow-lg transition-all duration-300 relative">
                            <summary class="flex items-center justify-between p-5 md:p-6 cursor-pointer hover:bg-[#1c222b] transition-colors focus:outline-none">
                                <div class="flex items-center gap-5">
                                    <!-- Círculo Ámbar -->
                                    <div class="w-12 h-12 rounded-full bg-amber/10 text-amber flex items-center justify-center font-bold text-xl border border-amber/30 relative shadow-[0_0_15px_rgba(251,191,36,0.15)] shrink-0">
                                        ${modulo.numero}
                                        <div class="absolute inset-0 rounded-full bg-amber/20 animate-ping opacity-20 hidden group-hover:block"></div>
                                    </div>
                                    <h2 class="text-xl md:text-2xl font-bold text-white group-hover:text-amber transition-colors">${modulo.titulo}</h2>
                                </div>
                                <div class="flex items-center gap-4 text-gray-400">
                                    <span class="text-xs md:text-sm font-medium bg-base py-1 px-3 rounded-md border border-border hidden md:inline-block">
                                        ${modulo.recursos.length} Actividades
                                    </span>
                                    <div class="w-8 h-8 rounded-full bg-base border border-border flex items-center justify-center group-hover:border-amber/50 transition-colors">
                                        <i class="ph ph-caret-down text-lg transition-transform duration-300 caret-icon group-hover:text-amber"></i>
                                    </div>
                                </div>
                            </summary>
                            <div class="border-t border-border bg-base/30 p-4 md:p-6">
                                <div class="flex flex-col gap-3">
                                    ${modulo.recursos.map(recurso => renderizarRecurso(recurso)).join('')}
                                </div>
                            </div>
                        </details>
                    `;
                } else if (modulo.estado === "bloqueado") {
                    // MÓDULO BLOQUEADO: Opaco, sin recursos, ícono de candado
                    htmlModulos += `
                        <div class="bg-card border border-border rounded-xl mb-6 p-5 md:p-6 flex items-center justify-between opacity-50 grayscale select-none relative">
                            <div class="flex items-center gap-5">
                                <div class="w-12 h-12 rounded-full bg-gray-800 text-gray-500 flex items-center justify-center font-bold text-xl border border-gray-700 shrink-0">
                                    ${modulo.numero}
                                </div>
                                <div>
                                    <p class="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-1">Módulo Bloqueado</p>
                                    <h2 class="text-xl md:text-2xl font-bold text-gray-400">${modulo.titulo}</h2>
                                </div>
                            </div>
                            <div class="text-gray-500 w-10 h-10 flex items-center justify-center bg-base rounded-full border border-border/50">
                                <i class="ph-fill ph-lock-key text-xl"></i>
                            </div>
                        </div>
                    `;
                }
            });

            contenedor.innerHTML = htmlModulos;
        }

        function renderizarRecurso(recurso) {
            let iconoHTML = '';
            let accionDerechaHTML = '';
            let estilosFila = 'hover:bg-[#1a212a] border border-transparent hover:border-border';

            // Mapeo (switch) para el tipo de recurso
            switch (recurso.tipo) {
                case 'app':
                    // Icono de app cian
                    iconoHTML = '<div class="w-12 h-12 rounded-lg bg-cyan-500/10 text-cyan-400 flex items-center justify-center text-2xl shadow-inner border border-cyan-500/20"><i class="ph ph-flask"></i></div>';
                    estilosFila = 'bg-[#1a1f26]/80 border border-cyan-500/30 hover:border-cyan-500/60 shadow-[0_4px_20px_-5px_rgba(6,182,212,0.15)] relative overflow-hidden';
                    break;
                case 'pdf':
                    // Icono de archivo azul
                    iconoHTML = '<div class="w-12 h-12 rounded-lg bg-blue-500/10 text-blue-400 flex items-center justify-center text-2xl shadow-inner border border-blue-500/20"><i class="ph ph-file-pdf"></i></div>';
                    break;
                case 'video':
                    // Icono de play rojo/rosa
                    iconoHTML = '<div class="w-12 h-12 rounded-lg bg-rose-500/10 text-rose-400 flex items-center justify-center text-2xl shadow-inner border border-rose-500/20"><i class="ph ph-play-circle"></i></div>';
                    break;
                case 'test':
                    // Icono de examen verde/gris (usaré verde esmeralda)
                    iconoHTML = '<div class="w-12 h-12 rounded-lg bg-emerald-500/10 text-emerald-400 flex items-center justify-center text-2xl shadow-inner border border-emerald-500/20"><i class="ph ph-exam"></i></div>';
                    break;
                case 'rpg':
                    // DESTACADO RPG
                    iconoHTML = '<div class="w-12 h-12 rounded-lg bg-amber/20 text-amber flex items-center justify-center text-2xl border border-amber/40 shadow-[0_0_10px_rgba(251,191,36,0.3)]"><i class="ph ph-game-controller"></i></div>';
                    estilosFila = 'bg-[#1a1f26]/80 border border-amber/30 hover:border-amber/60 shadow-[0_4px_20px_-5px_rgba(251,191,36,0.15)] relative overflow-hidden';
                    break;
                default:
                    iconoHTML = '<div class="w-12 h-12 rounded-lg bg-gray-500/10 text-gray-400 flex items-center justify-center text-2xl"><i class="ph ph-file"></i></div>';
            }

            // Lógica de Estado completado o Botón JUGAR (rpg)
            if (recurso.tipo === 'rpg') {
                // En lugar de check, botón JUGAR en color ámbar
                accionDerechaHTML = `
                    <a href="${recurso.url}" class="px-6 py-2.5 bg-gradient-to-r from-amber to-yellow-500 hover:from-yellow-400 hover:to-amber text-slate-900 font-bold rounded-lg transition-all duration-300 shadow-[0_0_15px_rgba(251,191,36,0.4)] hover:shadow-[0_0_20px_rgba(251,191,36,0.6)] transform hover:-translate-y-0.5 flex items-center gap-2">
                        <i class="ph-fill ph-play text-lg"></i> 
                        <span class="tracking-wide">JUGAR</span>
                    </a>
                `;
            } else if (recurso.tipo === 'app') {
                // Botón ABRIR APP en cyan
                accionDerechaHTML = `
                    <a href="${recurso.url}" class="px-4 py-2 bg-gradient-to-r from-cyan-600 to-cyan-400 hover:from-cyan-500 hover:to-cyan-300 text-white font-bold text-sm rounded-lg transition-all duration-300 shadow-[0_0_15px_rgba(6,182,212,0.4)] hover:shadow-[0_0_20px_rgba(6,182,212,0.6)] transform hover:-translate-y-0.5 flex items-center gap-2">
                        <i class="ph-bold ph-lightning text-base"></i> 
                        <span class="tracking-wide">ABRIR APP</span>
                    </a>
                `;
            } else {
                if (recurso.completado === true) {
                    // Check (✓) dorado a la derecha
                    accionDerechaHTML = '<div class="w-7 h-7 rounded-full bg-amber/20 text-amber flex items-center justify-center text-sm border border-amber/40 shadow-[0_0_5px_rgba(251,191,36,0.2)]" title="Completado"><i class="ph-bold ph-check"></i></div>';
                } else {
                    // Círculo vacío O
                    accionDerechaHTML = '<div class="w-7 h-7 rounded-full border-2 border-border flex items-center justify-center hover:border-gray-500 transition-colors" title="Pendiente"></div>';
                }
            }

            // Construir el contenedor del recurso (Ancla o Div dependiendo si es RPG o normal)
            // Hacemos que toda la fila sea clickeable siempre que no sea RPG ni APP (estos ya tienen botón adentro)
            const esAccionExterna = (recurso.tipo === 'rpg' || recurso.tipo === 'app');
            const TagFila = !esAccionExterna ? 'a' : 'div';
            const AtribHref = !esAccionExterna ? `href="${recurso.url}"` : '';

            // Si es RPG o APP, agregamos un brillo de fondo sutil
            let RpgGlow = '';
            if (recurso.tipo === 'rpg') {
                RpgGlow = '<div class="absolute top-0 right-0 w-32 h-full bg-gradient-to-l from-amber/5 to-transparent pointer-events-none"></div>';
            } else if (recurso.tipo === 'app') {
                RpgGlow = '<div class="absolute top-0 right-0 w-32 h-full bg-gradient-to-l from-cyan-500/5 to-transparent pointer-events-none"></div>';
            }

            return `
                <${TagFila} ${AtribHref} class="flex items-center justify-between p-3 md:p-4 rounded-xl transition-all duration-300 group/recurso ${estilosFila}">
                    ${RpgGlow}
                    <div class="flex items-center gap-4 z-10">
                        ${iconoHTML}
                        <div>
                            <h3 class="text-gray-200 font-medium text-lg leading-tight group-hover/recurso:text-amber transition-colors">${recurso.titulo}</h3>
                            <p class="text-sm text-gray-400 mt-1 flex items-center gap-2">
                                <span class="w-1.5 h-1.5 rounded-full bg-border"></span>
                                ${recurso.detalle}
                            </p>
                        </div>
                    </div>
                    <div class="pl-4 shrink-0 z-10">
                        ${accionDerechaHTML}
                    </div>
                </${TagFila}>
            `;
        }

        // Ejecutar en window.onload
        window.onload = renderizarCurso;
    </script>
</body>

</html>